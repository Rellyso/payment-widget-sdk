# üîí Seguran√ßa e Gerenciamento de Secrets

## ‚ö†Ô∏è REGRA DE OURO

> **NUNCA coloque secrets/API keys no frontend!**
>
> Qualquer coisa no navegador pode ser inspecionada pelo usu√°rio.

---

## üèóÔ∏è Arquitetura Segura Recomendada

### Fluxo Correto: Widget ‚Üí Backend do Cliente ‚Üí API de Pagamento

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    FRONTEND (Navegador)                     ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Payment Widget                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Coleta dados do usu√°rio                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ N√ÉO tem API keys                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ N√ÉO tem secrets                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Envia dados via callbacks                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                     ‚îÇ                                       ‚îÇ
‚îÇ                     ‚îÇ Dados do formul√°rio                   ‚îÇ
‚îÇ                     ‚îÇ (via onSuccess callback)              ‚îÇ
‚îÇ                     ‚ñº                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚îÇ HTTPS
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              BACKEND DO CLIENTE (Seguro)                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Servidor do E-commerce                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Recebe dados do widget                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ TEM as API keys (server-side)                     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ TEM os secrets                                    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Valida orderId                                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Faz requests para API de pagamento               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                     ‚îÇ                                       ‚îÇ
‚îÇ                     ‚îÇ Request com API Key                   ‚îÇ
‚îÇ                     ‚îÇ (Authorization: Bearer xxx)           ‚îÇ
‚îÇ                     ‚ñº                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                      ‚îÇ
                      ‚îÇ HTTPS + API Key
                      ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           API de Pagamento / Cart√£o Simples                 ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚Ä¢ Processa transa√ß√£o                                       ‚îÇ
‚îÇ  ‚Ä¢ Valida API Key                                          ‚îÇ
‚îÇ  ‚Ä¢ Retorna resultado                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚úÖ O Que PODE Ficar no Frontend

### 1. Identificadores P√∫blicos

```typescript
// ‚úÖ SEGURO - Pode ficar no frontend
window.PaymentWidget.init({
  orderId: "merchant-123", // ‚úÖ ID p√∫blico
  environment: "production", // ‚úÖ Config p√∫blica
  logoUrl: "https://...", // ‚úÖ URL p√∫blica
  apiBaseUrl: "https://seu-backend.com", // ‚úÖ SEU backend, n√£o a API de pagamento
});
```

### 2. Dados de Configura√ß√£o Visual

```typescript
// ‚úÖ SEGURO - Tema e UI
theme: {
  primaryColor: "#FF6600",
  secondaryColor: "#0A0A0A",
  borderRadius: "md",
}
```

### 3. Callbacks para Enviar Dados

```typescript
// ‚úÖ SEGURO - Callbacks enviam dados para SEU backend
onSuccess: async (data) => {
  // Widget coletou os dados, agora envia para SEU backend
  const response = await fetch("https://seu-backend.com/api/process-payment", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      orderId: data.orderId,
      token: data.token,  // Token tempor√°rio do widget
      // Seu backend que ter√° a API key real
    }),
  });

  // SEU backend processa com a API key segura
},
```

---

## ‚ùå O Que NUNCA Pode Ficar no Frontend

### 1. API Keys / Secrets

```typescript
// ‚ùå NUNCA FA√áA ISSO!
window.PaymentWidget.init({
  apiKey: "sk_live_abc123def456...", // ‚ùå EXPOSTO NO NAVEGADOR!
  secretKey: "secret_xyz...", // ‚ùå QUALQUER UM V√ä!
});
```

**Por qu√™?**

- Qualquer pessoa pode abrir DevTools (F12)
- Ver o c√≥digo-fonte da p√°gina
- Copiar suas API keys
- Fazer requests em seu nome
- Gerar cobran√ßas fraudulentas

### 2. Requests Diretos para API de Pagamento

```typescript
// ‚ùå NUNCA FA√áA ISSO!
const processPayment = async (cardData) => {
  const response = await fetch("https://api-pagamento.com/charge", {
    method: "POST",
    headers: {
      Authorization: "Bearer sk_live_abc123...", // ‚ùå EXPOSTO!
    },
    body: JSON.stringify(cardData),
  });
};
```

### 3. Dados Sens√≠veis de Configura√ß√£o

```typescript
// ‚ùå NUNCA FA√áA ISSO!
const config = {
  stripeSecretKey: "sk_...", // ‚ùå
  databasePassword: "pass123", // ‚ùå
  jwtSecret: "secret...", // ‚ùå
  encryptionKey: "key...", // ‚ùå
};
```

---

## üéØ Implementa√ß√£o Correta - Passo a Passo

### Passo 1: Widget Coleta Dados (Frontend)

```html
<!-- index.html -->
<script src="https://cdn.cartaosimples.com/widget.v1.min.js"></script>
<script>
  window.PaymentWidget.init({
    // ‚úÖ Apenas identificadores p√∫blicos
    orderId: "merchant-123",

    // ‚úÖ Aponta para SEU backend (n√£o a API de pagamento)
    apiBaseUrl: "https://seu-ecommerce.com/api",

    // ‚úÖ Callback envia dados para SEU backend
    onSuccess: async (data) => {
      try {
        // Widget retorna um token tempor√°rio
        const response = await fetch("/api/process-payment", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            token: data.token, // Token do widget
            orderId: data.orderId,
            amount: 10000, // R$ 100,00
            installments: data.installments,
          }),
        });

        const result = await response.json();

        if (result.success) {
          window.location.href = "/sucesso";
        } else {
          alert("Erro: " + result.message);
        }
      } catch (error) {
        console.error("Erro ao processar pagamento:", error);
      }
    },

    onError: (error) => {
      console.error("Erro no widget:", error);
    },
  });
</script>
```

### Passo 2: Backend Processa com API Key (Seguro)

```typescript
// backend/api/process-payment.ts
import express from "express";

const router = express.Router();

// ‚úÖ API Key est√° no servidor (segura)
const PAYMENT_API_KEY = process.env.PAYMENT_API_SECRET_KEY;
const PAYMENT_API_URL = process.env.PAYMENT_API_URL;

router.post("/process-payment", async (req, res) => {
  try {
    const { token, orderId, amount, installments } = req.body;

    // 1. Validar orderId (verificar se √© v√°lido para este cliente)
    if (!isValidMerchant(orderId)) {
      return res.status(403).json({
        success: false,
        message: "Merchant inv√°lido",
      });
    }

    // 2. Fazer request para API de pagamento COM a API key segura
    const response = await fetch(`${PAYMENT_API_URL}/charges`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${PAYMENT_API_KEY}`, // ‚úÖ Seguro no servidor
      },
      body: JSON.stringify({
        token,
        amount,
        installments,
        orderId,
        metadata: {
          source: "payment-widget",
          ip: req.ip,
          userAgent: req.headers["user-agent"],
        },
      }),
    });

    const result = await response.json();

    // 3. Retornar resultado (sem expor detalhes sens√≠veis)
    if (result.success) {
      res.json({
        success: true,
        transactionId: result.transactionId,
        message: "Pagamento processado com sucesso",
      });
    } else {
      res.status(400).json({
        success: false,
        message: result.error.message,
      });
    }
  } catch (error) {
    console.error("Erro ao processar pagamento:", error);
    res.status(500).json({
      success: false,
      message: "Erro interno do servidor",
    });
  }
});

function isValidMerchant(orderId: string): boolean {
  // Validar contra seu banco de dados
  const validMerchants = process.env.VALID_MERCHANTS?.split(",") || [];
  return validMerchants.includes(orderId);
}

export default router;
```

### Passo 3: Vari√°veis de Ambiente (Backend)

```bash
# .env (SERVIDOR - nunca commitar!)
NODE_ENV=production

# API de Pagamento (SECRETA)
PAYMENT_API_SECRET_KEY=sk_live_abc123def456...
PAYMENT_API_URL=https://api-pagamento.cartaosimples.com

# Merchants V√°lidos
VALID_MERCHANTS=merchant-123,merchant-456,merchant-789

# Database
DATABASE_URL=postgresql://...

# Seguran√ßa
JWT_SECRET=your-jwt-secret-here
SESSION_SECRET=your-session-secret-here
```

---

## üîê Tipos de Tokens e Keys

### 1. Public Key / Merchant ID (Frontend)

```typescript
// ‚úÖ PODE ficar no frontend
orderId: "merchant-123"; // Identificador p√∫blico
publishableKey: "pk_live_xyz..."; // Key p√∫blica (se aplic√°vel)
```

**Caracter√≠sticas:**

- Pode ser exposto publicamente
- Apenas identifica o merchant
- N√£o permite opera√ß√µes sens√≠veis

### 2. Secret Key / API Key (Backend ONLY)

```typescript
// ‚ùå NUNCA no frontend, APENAS no backend
secretKey: "sk_live_abc123..."; // Secret key
apiKey: "api_secret_xyz..."; // API key privada
```

**Caracter√≠sticas:**

- NUNCA pode ser exposta
- Permite opera√ß√µes cr√≠ticas
- Deve estar em vari√°veis de ambiente
- Rotacionada periodicamente

### 3. Tokens Tempor√°rios (Trafegam com Seguran√ßa)

```typescript
// ‚úÖ Token de uso √∫nico gerado pelo widget
token: "tok_1234567890abcdef";
```

**Caracter√≠sticas:**

- Uso √∫nico (n√£o pode ser reutilizado)
- Expira rapidamente (15-30 minutos)
- Representa dados do cart√£o de forma segura
- Pode ser enviado do frontend para backend

---

## üõ°Ô∏è Camadas de Seguran√ßa

### 1. HTTPS Obrigat√≥rio

```typescript
// ‚úÖ Sempre use HTTPS
apiBaseUrl: "https://seu-backend.com"; // ‚úÖ

// ‚ùå NUNCA use HTTP em produ√ß√£o
apiBaseUrl: "http://seu-backend.com"; // ‚ùå Inseguro!
```

### 2. CORS Restritivo (Backend)

```typescript
// backend/server.ts
import cors from "cors";

app.use(
  cors({
    origin: ["https://seu-site.com", "https://www.seu-site.com"],
    credentials: true,
  })
);
```

### 3. Rate Limiting

```typescript
// backend/middleware/rate-limit.ts
import rateLimit from "express-rate-limit";

const paymentLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutos
  max: 5, // 5 requests por IP
  message: "Muitas tentativas. Tente novamente mais tarde.",
});

app.use("/api/process-payment", paymentLimiter);
```

### 4. Valida√ß√£o de Origem

```typescript
// backend/middleware/validate-origin.ts
export function validateOrigin(req, res, next) {
  const origin = req.headers.origin;
  const allowedOrigins = process.env.ALLOWED_ORIGINS?.split(",") || [];

  if (!allowedOrigins.includes(origin)) {
    return res.status(403).json({
      error: "Origem n√£o autorizada",
    });
  }

  next();
}
```

### 5. Sanitiza√ß√£o de Dados

```typescript
// backend/utils/sanitize.ts
import validator from "validator";

export function sanitizePaymentData(data: any) {
  return {
    orderId: validator.escape(data.orderId),
    amount: Number.parseInt(data.amount),
    installments: Number.parseInt(data.installments),
    token: validator.escape(data.token),
  };
}
```

---

## üìã Checklist de Seguran√ßa

### Frontend (Widget)

- [ ] ‚úÖ Apenas `orderId` p√∫blico na configura√ß√£o
- [ ] ‚úÖ Sem API keys ou secrets no c√≥digo
- [ ] ‚úÖ HTTPS obrigat√≥rio em produ√ß√£o
- [ ] ‚úÖ Callbacks enviam dados para SEU backend
- [ ] ‚úÖ Shadow DOM para isolamento de estilos
- [ ] ‚úÖ CSP (Content Security Policy) configurado
- [ ] ‚úÖ SRI (Subresource Integrity) nos scripts CDN

### Backend (Seu Servidor)

- [ ] ‚úÖ API keys em vari√°veis de ambiente (`.env`)
- [ ] ‚úÖ Valida√ß√£o de orderId
- [ ] ‚úÖ CORS configurado corretamente
- [ ] ‚úÖ Rate limiting implementado
- [ ] ‚úÖ Logs de todas as transa√ß√µes
- [ ] ‚úÖ Valida√ß√£o de origem das requests
- [ ] ‚úÖ Sanitiza√ß√£o de inputs
- [ ] ‚úÖ HTTPS com certificado v√°lido
- [ ] ‚úÖ Secrets nunca logados/expostos
- [ ] ‚úÖ Rota√ß√£o peri√≥dica de API keys

### Infraestrutura

- [ ] ‚úÖ `.env` no `.gitignore`
- [ ] ‚úÖ Secrets em vault/secret manager (AWS Secrets, Azure Key Vault)
- [ ] ‚úÖ Backups regulares
- [ ] ‚úÖ Monitoramento de acessos suspeitos
- [ ] ‚úÖ Alertas para uso an√¥malo de API

---

## üö® O Que Fazer se API Key Vazar

### 1. Revogar Imediatamente

```bash
# Via CLI ou Dashboard
curl -X POST https://api-pagamento.com/keys/revoke \
  -H "Authorization: Bearer ADMIN_TOKEN" \
  -d "key_id=sk_live_abc123"
```

### 2. Gerar Nova Key

```bash
curl -X POST https://api-pagamento.com/keys/create \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

### 3. Atualizar Backend

```bash
# .env
PAYMENT_API_SECRET_KEY=sk_live_NEW_KEY_HERE
```

### 4. Redeploy

```bash
# Fazer deploy com nova key
npm run deploy
```

### 5. Investigar Impacto

- Verificar logs de acesso suspeito
- Checar transa√ß√µes n√£o autorizadas
- Notificar time de seguran√ßa

---

## üìö Recursos e Ferramentas

### An√°lise de Secrets no C√≥digo

```bash
# Instalar git-secrets
brew install git-secrets

# Configurar
git secrets --install
git secrets --register-aws

# Escanear reposit√≥rio
git secrets --scan
```

### Vari√°veis de Ambiente Seguras

```bash
# Usar secret manager (AWS)
aws secretsmanager create-secret \
  --name payment-api-key \
  --secret-string "sk_live_abc123..."

# Recuperar no runtime
const secret = await getSecret("payment-api-key");
```

### Auditoria de Depend√™ncias

```bash
# Verificar vulnerabilidades
npm audit
npm audit fix

# Usar Snyk
npx snyk test
```

---

## üéì Princ√≠pios de Seguran√ßa

### 1. Princ√≠pio do Menor Privil√©gio

Cada componente deve ter apenas as permiss√µes necess√°rias:

- Widget: Coleta dados, sem API keys
- Backend: Processa pagamentos, tem API keys
- Database: Acesso restrito ao backend

### 2. Defesa em Profundidade

M√∫ltiplas camadas de seguran√ßa:

- HTTPS (transporte)
- CORS (origem)
- Rate limiting (abuso)
- Valida√ß√£o (dados)
- Sanitiza√ß√£o (XSS)

### 3. Nunca Confie no Cliente

Sempre validar no servidor:

```typescript
// ‚ùå Valida√ß√£o apenas no frontend n√£o basta
if (amount > 0) {
  /* frontend */
}

// ‚úÖ Validar tamb√©m no backend
if (!amount || amount <= 0 || amount > MAX_AMOUNT) {
  return res.status(400).json({ error: "Valor inv√°lido" });
}
```

---

## üìñ Exemplos Completos

### Exemplo 1: E-commerce com Next.js

Ver: `/examples/security/nextjs-integration.ts`

### Exemplo 2: E-commerce com Express

Ver: `/examples/security/express-backend.ts`

### Exemplo 3: Valida√ß√£o de Merchant

Ver: `/examples/security/merchant-validation.ts`

---

## üîó Refer√™ncias

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [PCI DSS Compliance](https://www.pcisecuritystandards.org/)
- [Stripe Security Best Practices](https://stripe.com/docs/security)
- [MDN Web Security](https://developer.mozilla.org/en-US/docs/Web/Security)

---

**√öltima atualiza√ß√£o**: 6 de outubro de 2025
