<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Teste CDN CloudFront - Cart√£o Simples Widget</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Oxygen, Ubuntu, Cantarell, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }

            .container {
                background: white;
                border-radius: 16px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-width: 600px;
                width: 100%;
                padding: 40px;
            }

            h1 {
                color: #2d3748;
                margin-bottom: 10px;
                font-size: 28px;
            }

            .subtitle {
                color: #718096;
                margin-bottom: 30px;
                font-size: 14px;
            }

            .status {
                padding: 15px;
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 14px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .status.loading {
                background: #fef3c7;
                border: 1px solid #fbbf24;
                color: #92400e;
            }

            .status.success {
                background: #d1fae5;
                border: 1px solid #10b981;
                color: #065f46;
            }

            .status.error {
                background: #fee2e2;
                border: 1px solid #ef4444;
                color: #991b1b;
            }

            .status-icon {
                font-size: 20px;
            }

            .info-card {
                background: #f7fafc;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 20px;
            }

            .info-item {
                display: flex;
                justify-content: space-between;
                padding: 10px 0;
                border-bottom: 1px solid #e2e8f0;
            }

            .info-item:last-child {
                border-bottom: none;
            }

            .info-label {
                color: #718096;
                font-weight: 500;
                font-size: 13px;
            }

            .info-value {
                color: #2d3748;
                font-weight: 600;
                font-size: 13px;
                font-family: "Courier New", monospace;
            }

            .cdn-url {
                background: #1a202c;
                color: #68d391;
                padding: 15px;
                border-radius: 8px;
                font-family: "Courier New", monospace;
                font-size: 12px;
                margin-bottom: 20px;
                word-break: break-all;
                line-height: 1.6;
            }

            button {
                width: 100%;
                padding: 15px;
                background: #667eea;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
                margin-bottom: 10px;
            }

            button:hover {
                background: #5a67d8;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            }

            button:active {
                transform: translateY(0);
            }

            button:disabled {
                background: #cbd5e0;
                cursor: not-allowed;
                transform: none;
            }

            .logs {
                background: #1a202c;
                color: #a0aec0;
                padding: 15px;
                border-radius: 8px;
                font-family: "Courier New", monospace;
                font-size: 11px;
                max-height: 200px;
                overflow-y: auto;
                line-height: 1.6;
            }

            .log-entry {
                margin-bottom: 5px;
            }

            .log-time {
                color: #68d391;
            }

            .log-success {
                color: #68d391;
            }

            .log-error {
                color: #fc8181;
            }

            .log-info {
                color: #63b3ed;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .spinner {
                animation: spin 1s linear infinite;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <h1>üöÄ Teste CDN CloudFront</h1>
            <p class="subtitle">Cart√£o Simples Payment Widget</p>

            <div id="status" class="status loading">
                <span class="status-icon spinner">‚è≥</span>
                <span>Verificando conex√£o com CDN...</span>
            </div>

            <div class="cdn-url">
                <strong>CDN Base URL:</strong><br />
                https://d2x7cg3k3on9lk.cloudfront.net/
            </div>

            <div class="info-card">
                <div class="info-item">
                    <span class="info-label">Distribution ID:</span>
                    <span class="info-value">EOLJNTE5PW5O9</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Bootstrap:</span>
                    <span class="info-value" id="bootstrap-status"
                        >Carregando...</span
                    >
                </div>
                <div class="info-item">
                    <span class="info-label">CDN Bundle:</span>
                    <span class="info-value" id="cdn-status"
                        >Carregando...</span
                    >
                </div>
                <div class="info-item">
                    <span class="info-label">CSS:</span>
                    <span class="info-value" id="css-status"
                        >Carregando...</span
                    >
                </div>
            </div>

            <button id="test-btn" onclick="runTests()">
                üîÑ Executar Testes
            </button>
            <button onclick="openWidget()">üé® Abrir Widget de Pagamento</button>

            <h3 style="margin: 20px 0 10px; color: #2d3748; font-size: 16px">
                üìù Logs de Teste
            </h3>
            <div class="logs" id="logs"></div>
        </div>

        <script>
            const CDN_BASE_URL = "https://d2x7cg3k3on9lk.cloudfront.net";
            const FILES_TO_TEST = [
                {
                    name: "Bootstrap",
                    url: `${CDN_BASE_URL}/widget-bootstrap.v1.min.js`,
                    statusId: "bootstrap-status",
                },
                {
                    name: "CDN Bundle",
                    url: `${CDN_BASE_URL}/widget.v1.min.js`,
                    statusId: "cdn-status",
                },
                {
                    name: "CSS",
                    url: `${CDN_BASE_URL}/widget.v1.min.css`,
                    statusId: "css-status",
                },
            ];

            function log(message, type = "info") {
                const logsDiv = document.getElementById("logs");
                const time = new Date().toLocaleTimeString("pt-BR");
                const logClass =
                    type === "success"
                        ? "log-success"
                        : type === "error"
                          ? "log-error"
                          : "log-info";

                const logEntry = document.createElement("div");
                logEntry.className = "log-entry";
                logEntry.innerHTML = `<span class="log-time">[${time}]</span> <span class="${logClass}">${message}</span>`;

                logsDiv.appendChild(logEntry);
                logsDiv.scrollTop = logsDiv.scrollHeight;
            }

            async function testFile(file) {
                log(`Testando: ${file.name}...`, "info");

                try {
                    const response = await fetch(file.url, {
                        method: "HEAD",
                        cache: "no-cache",
                        mode: "cors",
                    });
                    const statusElement = document.getElementById(
                        file.statusId,
                    );

                    if (response.ok) {
                        const contentLength =
                            response.headers.get("content-length");
                        const size = contentLength
                            ? (parseInt(contentLength) / 1024).toFixed(2) +
                              " KB"
                            : "N/A";

                        statusElement.textContent = `‚úÖ ${size}`;
                        statusElement.style.color = "#10b981";
                        log(`‚úÖ ${file.name}: OK (${size})`, "success");
                        return true;
                    } else {
                        statusElement.textContent = `‚ùå ${response.status}`;
                        statusElement.style.color = "#ef4444";
                        log(
                            `‚ùå ${file.name}: HTTP ${response.status}`,
                            "error",
                        );
                        return false;
                    }
                } catch (error) {
                    const statusElement = document.getElementById(
                        file.statusId,
                    );
                    statusElement.textContent = "‚ùå Erro";
                    statusElement.style.color = "#ef4444";
                    log(`‚ùå ${file.name}: ${error.message}`, "error");
                    return false;
                }
            }

            async function runTests() {
                const statusDiv = document.getElementById("status");
                const testBtn = document.getElementById("test-btn");

                statusDiv.className = "status loading";
                statusDiv.innerHTML =
                    '<span class="status-icon spinner">‚è≥</span><span>Executando testes...</span>';
                testBtn.disabled = true;

                log("üöÄ Iniciando testes do CDN...", "info");

                const results = await Promise.all(
                    FILES_TO_TEST.map((file) => testFile(file)),
                );
                const allPassed = results.every((result) => result === true);

                if (allPassed) {
                    statusDiv.className = "status success";
                    statusDiv.innerHTML =
                        '<span class="status-icon">‚úÖ</span><span>Todos os arquivos est√£o acess√≠veis!</span>';
                    log("üéâ Todos os testes passaram com sucesso!", "success");
                } else {
                    statusDiv.className = "status error";
                    statusDiv.innerHTML =
                        '<span class="status-icon">‚ùå</span><span>Alguns arquivos n√£o foram encontrados</span>';
                    log(
                        "‚ö†Ô∏è Alguns testes falharam. Verifique os logs acima.",
                        "error",
                    );
                }

                testBtn.disabled = false;
            }

            function openWidget() {
                log("üé® Carregando widget do CDN...", "info");

                // Criar um container para o widget
                const widgetContainer = document.createElement("div");
                widgetContainer.id = "widget-test-container";
                widgetContainer.style.cssText =
                    "margin-top: 20px; padding: 20px; border: 2px dashed #667eea; border-radius: 8px; background: #f7fafc;";
                widgetContainer.innerHTML =
                    '<p style="color: #718096;">‚è≥ Carregando widget via CDN...</p>';

                document
                    .querySelector(".container")
                    .appendChild(widgetContainer);

                // Carregar o CSS primeiro
                const link = document.createElement("link");
                link.rel = "stylesheet";
                link.href = `${CDN_BASE_URL}/widget.v1.min.css`;
                link.onload = () => {
                    log("‚úÖ CSS carregado", "success");
                };
                link.onerror = () => {
                    log("‚ùå Erro ao carregar CSS", "error");
                };
                document.head.appendChild(link);

                // Carregar o bootstrap JS
                const script = document.createElement("script");
                script.src = `${CDN_BASE_URL}/widget-bootstrap.v1.min.js`;
                script.async = true;

                script.onload = () => {
                    log("‚úÖ Bootstrap carregado!", "success");
                    widgetContainer.innerHTML =
                        '<p style="color: #10b981;">‚úÖ Widget carregado com sucesso via CDN!</p>';

                    // Verificar se o widget est√° dispon√≠vel
                    setTimeout(() => {
                        if (window.PaymentWidget) {
                            log(
                                "‚úÖ PaymentWidget dispon√≠vel globalmente!",
                                "success",
                            );
                            widgetContainer.innerHTML +=
                                '<p style="color: #10b981; margin-top: 10px;">‚úÖ API PaymentWidget detectada!</p>';
                            widgetContainer.innerHTML +=
                                '<pre style="background: #1a202c; color: #68d391; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 11px; overflow-x: auto;">' +
                                "API dispon√≠vel:\n" +
                                JSON.stringify(
                                    Object.keys(window.PaymentWidget),
                                    null,
                                    2,
                                ) +
                                "</pre>";

                            // Adicionar bot√£o para testar abertura
                            const testButton = document.createElement("button");
                            testButton.textContent =
                                "üé® Testar Abertura do Widget";
                            testButton.style.cssText =
                                "margin-top: 15px; padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; width: 100%;";
                            testButton.onclick = () => {
                                log("üöÄ Inicializando widget...", "info");

                                window.PaymentWidget.init({
                                    orderId: "demo-merchant-id",
                                    primaryColor: "#667eea",
                                    environment: "staging",
                                    autoOpen: true,
                                    onOpen: () => {
                                        log("‚úÖ Widget aberto!", "success");
                                    },
                                    onClose: () => {
                                        log("‚ÑπÔ∏è Widget fechado", "info");
                                    },
                                    onError: (error) => {
                                        log(
                                            `‚ùå Erro: ${error.message}`,
                                            "error",
                                        );
                                    },
                                });
                            };
                            widgetContainer.appendChild(testButton);
                        } else if (window.CartaoSimplesWidget) {
                            log(
                                "‚úÖ CartaoSimplesWidget (bundle direto) dispon√≠vel!",
                                "success",
                            );
                            widgetContainer.innerHTML +=
                                '<p style="color: #10b981; margin-top: 10px;">‚úÖ Bundle CDN carregado diretamente</p>';
                            widgetContainer.innerHTML +=
                                '<pre style="background: #1a202c; color: #68d391; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 11px; overflow-x: auto;">' +
                                JSON.stringify(
                                    Object.keys(window.CartaoSimplesWidget),
                                    null,
                                    2,
                                ) +
                                "</pre>";
                        } else {
                            log("‚ö†Ô∏è Nenhuma API de widget encontrada", "error");
                            widgetContainer.innerHTML +=
                                '<p style="color: #f59e0b; margin-top: 10px;">‚ö†Ô∏è Widget carregado mas objeto global n√£o detectado</p>';
                            widgetContainer.innerHTML +=
                                '<p style="color: #718096; margin-top: 5px; font-size: 12px;">Verifique se os arquivos est√£o sendo servidos corretamente</p>';
                        }
                    }, 500);
                };

                script.onerror = () => {
                    log("‚ùå Erro ao carregar bootstrap", "error");
                    widgetContainer.innerHTML =
                        '<p style="color: #ef4444;">‚ùå Erro ao carregar widget do CDN</p>';
                };

                document.body.appendChild(script);
            }

            // Executar testes automaticamente ao carregar a p√°gina
            window.addEventListener("load", () => {
                log("üì° P√°gina carregada. Iniciando verifica√ß√µes...", "info");
                setTimeout(runTests, 1000);
            });
        </script>
    </body>
</html>
