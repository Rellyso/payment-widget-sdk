<!doctype html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Teste Widget Direto - CDN</title>

        <!-- CSS do Widget -->
        <link
            rel="stylesheet"
            href="https://d2x7cg3k3on9lk.cloudfront.net/widget.v1.min.css"
        />

        <style>
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                max-width: 800px;
                margin: 50px auto;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
            }

            .card {
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                margin-bottom: 20px;
            }

            h1 {
                color: #2d3748;
                margin-bottom: 10px;
            }

            .status {
                padding: 12px;
                border-radius: 6px;
                margin: 15px 0;
                font-size: 14px;
            }

            .success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }

            .error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }

            .info {
                background: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }

            button {
                background: #667eea;
                color: white;
                border: none;
                padding: 12px 24px;
                font-size: 16px;
                border-radius: 6px;
                cursor: pointer;
                margin: 10px 5px 10px 0;
                transition: all 0.2s;
            }

            button:hover {
                background: #5a67d8;
                transform: translateY(-2px);
            }

            button:disabled {
                background: #cbd5e0;
                cursor: not-allowed;
                transform: none;
            }

            .code {
                background: #1a202c;
                color: #68d391;
                padding: 15px;
                border-radius: 6px;
                font-family: "Courier New", monospace;
                font-size: 12px;
                overflow-x: auto;
                margin: 15px 0;
            }

            #widget-root {
                min-height: 50px;
            }
        </style>
    </head>

    <body>
        <div class="card">
            <h1>üé® Teste Widget - CDN Direto</h1>
            <p style="color: #718096; margin-bottom: 20px">
                Teste de carregamento direto do bundle CDN
            </p>

            <div id="status" class="status info">
                ‚è≥ Carregando widget do CDN...
            </div>

            <div id="api-info"></div>

            <div>
                <button id="btn-init" onclick="initWidget()" disabled>
                    üöÄ Inicializar Widget
                </button>
                <button id="btn-open" onclick="openWidget()" disabled>
                    üìÇ Abrir Modal
                </button>
                <button id="btn-close" onclick="closeWidget()" disabled>
                    ‚úñÔ∏è Fechar Modal
                </button>
            </div>

            <h3 style="margin-top: 30px; color: #2d3748">
                üì¶ Container do Widget
            </h3>
            <div id="widget-root"></div>

            <h3 style="margin-top: 30px; color: #2d3748">üîç Debug Info</h3>
            <div class="code" id="debug-info">Aguardando carregamento...</div>
        </div>

        <!-- Bundle CDN do Widget (inclui React) -->
        <script src="https://d2x7cg3k3on9lk.cloudfront.net/widget.v1.min.js"></script>

        <script>
            let widgetInstance = null;

            function updateStatus(message, type = "info") {
                const statusDiv = document.getElementById("status");
                statusDiv.className = `status ${type}`;
                statusDiv.innerHTML = message;
            }

            function updateDebug(info) {
                document.getElementById("debug-info").textContent =
                    JSON.stringify(info, null, 2);
            }

            function checkWidgetLoaded() {
                const debugInfo = {
                    timestamp: new Date().toISOString(),
                    window: {
                        CartaoSimplesWidget: !!window.CartaoSimplesWidget,
                        PaymentWidget: !!window.PaymentWidget,
                        React: !!window.React,
                        ReactDOM: !!window.ReactDOM,
                    },
                };

                if (window.CartaoSimplesWidget) {
                    updateStatus(
                        "‚úÖ Bundle CDN carregado com sucesso!",
                        "success",
                    );

                    const apiInfo = document.getElementById("api-info");
                    apiInfo.innerHTML = `
          <div class="success" style="margin: 15px 0;">
            <strong>‚úÖ API CartaoSimplesWidget detectada!</strong><br>
            <small>M√©todos dispon√≠veis: ${Object.keys(window.CartaoSimplesWidget).join(", ")}</small>
          </div>
        `;

                    document.getElementById("btn-init").disabled = false;

                    debugInfo.api = {
                        methods: Object.keys(window.CartaoSimplesWidget),
                        hasMount:
                            typeof window.CartaoSimplesWidget.mount ===
                            "function",
                    };
                } else {
                    updateStatus(
                        "‚ùå Erro: CartaoSimplesWidget n√£o foi carregado",
                        "error",
                    );
                    debugInfo.error =
                        "CartaoSimplesWidget n√£o encontrado no window";
                }

                updateDebug(debugInfo);
            }

            function initWidget() {
                if (!window.CartaoSimplesWidget) {
                    alert("‚ùå CartaoSimplesWidget n√£o dispon√≠vel");
                    return;
                }

                try {
                    const container = document.getElementById("widget-root");

                    updateStatus("üîÑ Montando widget no container...", "info");

                    const config = {
                        orderId: "demo-merchant-123",
                        primaryColor: "#667eea",
                        secondaryColor: "#764ba2",
                        environment: "staging",
                        onClose: () => {
                            updateStatus(
                                "‚ÑπÔ∏è Widget fechado pelo usu√°rio",
                                "info",
                            );
                        },
                        onError: (error) => {
                            updateStatus(`‚ùå Erro: ${error.message}`, "error");
                        },
                    };

                    widgetInstance = window.CartaoSimplesWidget.mount(
                        container,
                        config,
                    );

                    updateStatus(
                        "‚úÖ Widget inicializado com sucesso!",
                        "success",
                    );

                    document.getElementById("btn-open").disabled = false;
                    document.getElementById("btn-close").disabled = false;
                    document.getElementById("btn-init").disabled = true;

                    updateDebug({
                        status: "initialized",
                        instance: {
                            hasOpen: typeof widgetInstance?.open === "function",
                            hasClose:
                                typeof widgetInstance?.close === "function",
                            methods: widgetInstance
                                ? Object.keys(widgetInstance)
                                : [],
                        },
                        config: config,
                    });
                } catch (error) {
                    updateStatus(
                        `‚ùå Erro ao inicializar: ${error.message}`,
                        "error",
                    );
                    console.error("Erro detalhado:", error);
                }
            }

            function openWidget() {
                if (!widgetInstance) {
                    alert(
                        '‚ùå Widget n√£o foi inicializado. Clique em "Inicializar Widget" primeiro.',
                    );
                    return;
                }

                try {
                    widgetInstance.open();
                    updateStatus("‚úÖ Widget aberto!", "success");
                } catch (error) {
                    updateStatus(`‚ùå Erro ao abrir: ${error.message}`, "error");
                }
            }

            function closeWidget() {
                if (!widgetInstance) {
                    alert("‚ùå Widget n√£o foi inicializado.");
                    return;
                }

                try {
                    widgetInstance.close();
                    updateStatus("‚ÑπÔ∏è Widget fechado", "info");
                } catch (error) {
                    updateStatus(
                        `‚ùå Erro ao fechar: ${error.message}`,
                        "error",
                    );
                }
            }

            // Verificar carregamento ap√≥s um delay
            window.addEventListener("load", () => {
                setTimeout(checkWidgetLoaded, 500);
            });
        </script>
    </body>
</html>
